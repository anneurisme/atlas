<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KoG Atlas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; }

    #map {
      position: absolute;
      top: 68px;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000;
    }

    .custom-popup { font-family: Arial, sans-serif; font-size: 14px; }

    .label-with-emoji {
      display: inline-flex;
      align-items: center;
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 2px 6px 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.6);
      white-space: nowrap;
      transition: transform .15s ease, filter .15s ease, opacity .15s ease;
    }

    .label-with-emoji .label-emoji { margin-right: 4px; transform: translateX(-4px); }

    .emoji-dot {
      font-size: 18px;
      line-height: 18px;
      text-align: center;
      text-shadow: 0 0 3px rgba(0,0,0,0.8);
      transition: transform .15s ease, filter .15s ease, opacity .15s ease, font-size .15s ease;
    }

    .marker-highlight { filter: drop-shadow(0 0 8px rgba(255,215,0,.9)); }
    .marker-highlight .emoji-dot { font-size: 26px; }
    .marker-highlight .label-with-emoji { transform: scale(1.8); }
    .marker-dim { opacity: .45; }

    #top-bar {
      position: fixed;
      inset: 0 0 auto 0;
      height: 68px;
      background: rgba(0,0,0,.9);
      border-bottom: 1px solid rgba(255,255,255,.15);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 9000;
      font-family: Arial, sans-serif;
      color: #f5f5f5;
    }

    .top-left { display: flex; align-items: center; gap: 8px; height: 68px; }
    .top-logo { height: calc(100% - 6px); margin: 3px 0; width: auto; object-fit: contain; display: block; }
    .top-title { font-weight: bold; }

    /* Legend */
    #legend {
      position: fixed;
      top: 78px;
      right: 12px;
      z-index: 9200;
      background: rgba(0,0,0,.82);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 8px;
      box-shadow: 0 10px 28px rgba(0,0,0,.75);
      padding: 10px 12px;
      min-width: 160px;
      backdrop-filter: blur(3px);
      font-family: Arial, sans-serif;
      color: #f2f2f2;
    }

    .legend-title {
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: #ccc;
      margin-bottom: 8px;
    }

    .legend-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 0;
      cursor: pointer;
    }

    .legend-row input {
      width: 14px;
      height: 14px;
      accent-color: #fbac3a;
    }

    .legend-label { font-size: 13px; }

    /* Bottom drawer */
    #bottom-drawer {
      position: fixed;
      inset: auto 0 0 0;
      height: 275px;
      background: rgba(0,0,0,.96);
      border-top: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 -8px 25px rgba(0,0,0,.9);
      z-index: 9500;
      transition: height .25s ease;
      display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
    }

    #bottom-drawer.collapsed { height: 32px; }

    #drawer-header {
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: linear-gradient(to top, #000, #141414);
      color: #ccc;
    }

    #drawer-chevron { font-size: 28px; margin-top: 8px; }

    #drawer-body { flex: 1; display: flex; padding: 8px 10px 10px; gap: 10px; }

    .drawer-left, .drawer-right {
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(8,8,8,.95);
      flex: 1;
      padding: 10px 12px;
      overflow: hidden;
    }

    .drawer-right {
      flex: 0 0 55%;
      background: radial-gradient(circle at top, #222, #050505 60%);
    }

    #image-lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.92);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    #image-lightbox img {
      max-width: 90vw;
      max-height: 80vh;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,.4);
    }

    #lightbox-close {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,.85);
      color: #fff;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="top-bar">
  <div class="top-left">
    <img src="assets/logo.png" class="top-logo" alt="Logo" />
    <div class="top-title">Royal Cartography Bureau</div>
  </div>
</div>

<div id="map"></div>

<div id="legend">
  <div class="legend-title">Legend</div>

  <label class="legend-row">
    <input type="checkbox" id="toggle-overlay-1">
    <span class="legend-label">Topographic</span>
  </label>

  <label class="legend-row">
    <input type="checkbox" id="toggle-overlay-2">
    <span class="legend-label">Blended</span>
  </label>
</div>

<div id="bottom-drawer" class="collapsed">
  <div id="drawer-header"><span id="drawer-chevron">▲</span></div>
  <div id="drawer-body">
    <div class="drawer-left"></div>
    <div class="drawer-right"></div>
  </div>
</div>

<div id="image-lightbox">
  <img id="lightbox-image" />
  <button id="lightbox-close">×</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const mapBounds = [[0,0],[1049,875]];

  const map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -2,
    maxZoom: 4,
    attributionControl: false
  });

  L.imageOverlay('assets/map.jpg', mapBounds).addTo(map);
  map.fitBounds(mapBounds);

  /* Overlays OFF by default */
  const overlayA = L.imageOverlay('assets/overlays/overlay-a.png', mapBounds, { opacity: 1.0 });
  const overlayB = L.imageOverlay('assets/overlays/overlay-b.png', mapBounds, { opacity: 0.5 });

  const overlayConfig = { overlayA, overlayB };

  const bindOverlayToggle = (id, layer) => {
    const el = document.getElementById(id);
    el.addEventListener('change', () => {
      el.checked ? layer.addTo(map) : map.removeLayer(layer);
    });
  };

  bindOverlayToggle('toggle-overlay-1', overlayConfig.overlayA);
  bindOverlayToggle('toggle-overlay-2', overlayConfig.overlayB);
</script>
</body>
</html>
